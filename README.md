# Telegram Publisher

Telegram Publisher ‚Äî —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤ –≤ Telegram‚Äë–∫–∞–Ω–∞–ª –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ —Ç–µ–∑–∏—Å–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–æ—Ç—É –≤ –ª–∏—á–∫—É.

–ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–æ—Ç–æ, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç —Å –ø–æ–º–æ—â—å—é Mistral AI –∏ –ø–æ –∫–æ–º–∞–Ω–¥–µ –∞–≤—Ç–æ—Ä–∞ –ø—É–±–ª–∏–∫—É–µ—Ç –≥–æ—Ç–æ–≤—ã–π –ø–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª.

---
## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
cd /opt/telegram-publisher git pull origin main # –ø—Ä–∏ –æ–±–Ω–æ–ª–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ —Ñ–∞–π–ª–∞, –Ω–µ —Ç–æ–ª—å–∫–æ main.py

## –ó–∞–ø—É—Å–∫
cd /opt/telegram-publisher       
source venv/bin/activate
python polling_bot.py

## –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –¥–≤—É—Ö –±–æ—Ç–æ–≤
cd /opt/telegram-publisher ps aux | grep polling_bot.py
cd /opt/telegram-publisher kill 123456 #–≤–≤–µ—Å—Ç–∏ PID
cd /opt/telegram-publisher       
source venv/bin/activate
python polling_bot.py

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ü—Ä–∏—ë–º —Ñ–æ—Ç–æ –∏ –ø–æ–¥–ø–∏—Å–∏ –æ—Ç –∞–≤—Ç–æ—Ä–∞ –≤ Telegram.
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞‚Äë–ø–æ–¥–ø–∏—Å–∏ –∫ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ Mistral.
- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (`–æ–∫` / `–Ω–µ—Ç`).
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª.
- –†–∞–±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ polling (–±–µ–∑ webhook), –∑–∞–ø—É—Å–∫ –∫–∞–∫ systemd‚Äë—Å–µ—Ä–≤–∏—Å.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- `services.py` ‚Äî –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞:
  - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π;
  - –≤—ã–∑–æ–≤ Mistral API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞;
  - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ –≤ –∫–∞–Ω–∞–ª.
- `polling_bot.py` ‚Äî Telegram‚Äë–±–æ—Ç –Ω–∞ aiogram 3:
  - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ polling;
  - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ç–æ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã;
  - –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `services.py`.
- `main.py` ‚Äî —Å—Ç–∞—Ä—ã–π HTTP‚Äë—Å–µ—Ä–≤–∏—Å:
  - –≤–∞—Ä–∏–∞–Ω—Ç –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–±‚Äë—Å–µ—Ä–≤–µ—Ä / webhook;
  - –≤ –Ω—ë–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã–∑–æ–≤ Mistral –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –∏ —Ç–µ–∑–∏—Å–∞–º;
  - —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–∏–º–µ—Ä –∏ –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–¥ –≤–æ–∑–º–æ–∂–Ω—ã–π –±—É–¥—É—â–∏–π –≤–µ–±‚Äë–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

–í –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –±–æ—Ç**: –æ–Ω –æ–±—â–∞–µ—Ç—Å—è —Å –∞–≤—Ç–æ—Ä–æ–º –≤ –ª–∏—á–∫–µ –∏ –æ—Ç —Å–≤–æ–µ–≥–æ –∏–º–µ–Ω–∏ –ø—É–±–ª–∏–∫—É–µ—Ç –ø–æ—Å—Ç—ã –≤ –∫–∞–Ω–∞–ª.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/vsanyanov-ux/telegram-publisher.git
cd telegram-publisher

python -m venv venv
source venv/bin/activate   # Windows: venv\Scripts\activate

pip install -r requirements.txt
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ `@BotFather` –∏ –ø–æ–ª—É—á–∏—Ç–µ `BOT_TOKEN`.
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª –∏ –∑–∞–¥–∞–π—Ç–µ –µ–º—É username, –Ω–∞–ø—Ä–∏–º–µ—Ä `@forma_test`.
3. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤ –∫–∞–Ω–∞–ª —Å –ø—Ä–∞–≤–æ–º ¬´–ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è¬ª.

–í `services.py` —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è:

```python
BOT_TOKEN = "–í–ê–®_–ë–û–¢_–¢–û–ö–ï–ù"
CHANNEL_USERNAME = "@forma_test"          # username –∫–∞–Ω–∞–ª–∞
MISTRAL_API_KEY = "–í–ê–®_MISTRAL_API_KEY"
```

`BOT_TOKEN` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–æ–∫–µ–Ω–æ–º –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–æ–º –≤ –∫–∞–Ω–∞–ª.

---

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ê–≤—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–æ—Ç—É —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é‚Äë—Ç–µ–∑–∏—Å–∞–º–∏.
2. –ë–æ—Ç:
   - —Å–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ;
   - –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç `file_id`, –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏ –ø–æ–¥–ø–∏—Å—å;
   - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∑–∏—Å—ã –≤ Mistral –∏ –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏.
3. –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–æ—Ç:
   - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ—Ä—É —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏;
   - –∑–∞—Ç–µ–º –ø–∏—à–µ—Ç:  
     ¬´–ì–æ—Ç–æ–≤–æ! ‚úçÔ∏è  
     –ù—Ä–∞–≤–∏—Ç—Å—è? –ù–∞–ø–∏—à–∏ `–æ–∫` ‚úÖ  
     –ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è? –ù–∞–ø–∏—à–∏ `–Ω–µ—Ç`‚ùå ‚Äî —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é –¥—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç üîÑ¬ª.
4. –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç:
   - `–æ–∫` ‚Äî –±–æ—Ç –ø—É–±–ª–∏–∫—É–µ—Ç —Ñ–æ—Ç–æ + —Ç–µ–∫—Å—Ç –≤ –∫–∞–Ω–∞–ª –∏ –æ—á–∏—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ;
   - `–Ω–µ—Ç` ‚Äî –±–æ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ç–µ–∫—Å—Ç–∞ –∏ —Å–Ω–æ–≤–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.

---

## –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

–û—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–±–æ—á–∏–π –≤—Ö–æ–¥ ‚Äî `polling_bot.py`:

```bash
cd /opt/telegram-publisher          # –∏–ª–∏ –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
source venv/bin/activate
python polling_bot.py
```

`main.py` –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω HTTP‚Äë—Ä–µ–∂–∏–º/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–µ–±‚Äë—Å–µ—Ä–≤–µ—Ä–æ–º: –æ–Ω —Ç–∞–∫–∂–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ Mistral –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏.

---

## –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–µ —á–µ—Ä–µ–∑ systemd

–ü—Ä–∏–º–µ—Ä unit‚Äë—Ñ–∞–π–ª–∞ `/etc/systemd/system/telegram-bot.service`:

```ini
[Unit]
Description=Telegram FormaVolgodonskBot
After=network.target

[Service]
Type=simple
User=YOUR_USER
WorkingDirectory=/opt/telegram-publisher
Environment=PYTHONPATH=/opt/telegram-publisher
ExecStart=/opt/telegram-publisher/venv/bin/python /opt/telegram-publisher/polling_bot.py
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
```

–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```bash
sudo systemctl daemon-reload
sudo systemctl start telegram-bot.service
sudo systemctl enable telegram-bot.service   # –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl status telegram-bot.service   # —Å—Ç–∞—Ç—É—Å
journalctl -u telegram-bot.service -f        # –ª–æ–≥–∏
```

---

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- `bots can't send messages to bots` ‚Äî –≤ `chat_id` —É–∫–∞–∑–∞–Ω –¥—Ä—É–≥–æ–π –±–æ—Ç, –Ω—É–∂–Ω–æ username –∫–∞–Ω–∞–ª–∞ –∏–ª–∏ –µ–≥–æ chat_id.
- `wrong file identifier/HTTP URL specified` ‚Äî `file_id` –≤–∑—è—Ç —É –¥—Ä—É–≥–æ–≥–æ –±–æ—Ç–∞; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–∏—ë–º–∞ —Ñ–æ—Ç–æ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∫–∞–Ω–∞–ª.
- `bot is not a member of the channel chat` ‚Äî –±–æ—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –≤ –∫–∞–Ω–∞–ª.
- `terminated by other getUpdates request` ‚Äî –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –±–æ—Ç–∞; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω systemd‚Äë—Å–µ—Ä–≤–∏—Å.

---

## –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤.
- –ò—Å—Ç–æ—Ä–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π.
- –í–µ–±‚Äë–ø–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å—Ç–∏–ª—è —Ç–µ–∫—Å—Ç–æ–≤ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ª–æ–≥–∏–∫–∏ –∏–∑ `main.py`).
